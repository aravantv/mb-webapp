<!DOCTYPE HTML>
<html>

<head>
    <meta charset="UTF-8">
    <title>Elm â€¢ TodoMVC</title>
    <script type="text/javascript" src="main.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
</body>

<script type="text/javascript">
    function setValue(path, val, obj) {
        var fields = path.split('.');
        var result = obj;
        for (var i = 0, n = fields.length; i < n && result !== undefined; i++) {
            var field = fields[i];
            if (i === n - 1) {
                result[field] = val;
            } else {
                if (typeof result[field] === 'undefined' || !_.isObject(result[field])) {
                    result[field] = {};
                }
                result = result[field];
            }
        }
    }

    var serializedState = localStorage.getItem('localStorageResourceMBWebapp');
    var state = serializedState ? JSON.parse(serializedState) : "";
    var mbwebapp = Elm.Main.fullscreen();
    mbwebapp.ports.addItem.subscribe(function (i, v) {
        state.splice(i, 0, v);
        localStorage.setItem('localStorageResourceMBWebapp', JSON.stringify(state));
        mbwebapp.ports.itemAdded.send(i, v);
    });
    mbwebapp.ports.removeItem.subscribe(function (i) {
        state.splice(i, 1);
        localStorage.setItem('localStorageResourceMBWebapp', JSON.stringify(state));
        mbwebapp.ports.itemRemoved.send(i);
    });
    for (i = 0; i < state.length; i++) {
        mbwebapp.ports.itemAdded.send(i, state[i]);
    }
</script>

</html>
